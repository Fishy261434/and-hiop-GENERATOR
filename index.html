<script>
/* ----------  CONFIG  ---------- */
// How many different variants you want in the pool
const POOL_SIZE = 1000;

/* ----------  HOMOGLYPHS & ZERO‑WIDTHS  ---------- */
const ZW = "\u200B";                   // zero‑width space
const charVariants = {
  a: ["a", "а"],                      // Latin a, Cyrillic a
  n: ["n", "п", "n" + ZW],            // Latin n, Cyrillic pe, n+ZW
  d: ["d", "д", "d" + ZW],            // Latin d, Cyrillic de, d+ZW
  " ": [" ", ZW],                     // real space or ZW (glues words)
  h: ["h", "һ", "h" + ZW],            // Latin h, Cyrillic shha, h+ZW
  i: ["i", "і", "i" + ZW],            // Latin i, Cyrillic i, i+ZW
  o: ["o", "о", "o" + ZW],            // Latin o, Cyrillic o, o+ZW
  p: ["p", "р", "p" + ZW]             // Latin p, Cyrillic er, p+ZW
};

/* ----------  BUILD THE VARIANT POOL  ---------- */
function cartesian(current, keys, out) {
  if (current.length === keys.length) {
    out.push(current.join(""));
    return;
  }
  const key = keys[current.length];
  for (const choice of charVariants[key]) {
    cartesian([...current, choice], keys, out);
  }
}

function buildVariantPool(size) {
  const all = [];
  cartesian([], ["a","n","d"," ","h","i","o","p"], all);
  // Shuffle with Fisher‑Yates
  for (let i = all.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [all[i], all[j]] = [all[j], all[i]];
  }
  return all.slice(0, size);
}

const VARIANTS = buildVariantPool(POOL_SIZE);  // array holding 1 000 uniques
let variantIndex = 0;                          // pointer to “next” unused item

/* ----------  CORE STEALTHIFY ---------- */
function applyCasePattern(sample, variant) {
  if (sample === sample.toUpperCase()) return variant.toUpperCase();
  if (sample[0] === sample[0].toUpperCase())
    return variant[0].toUpperCase() + variant.slice(1);
  return variant.toLowerCase();
}

function stealthify(text) {
  return text.replace(/and hiop/gi, (match) => {
    // Out of variants?  Return original so user notices.
    if (variantIndex >= VARIANTS.length) return match;
    const obf = applyCasePattern(match, VARIANTS[variantIndex]);
    variantIndex++;            // burn this variant – never reused this session
    return obf;
  });
}

function convert() {
  const input = document.getElementById("input").value;
  const output = stealthify(input);
  document.getElementById("output").value = output;
}
</script>
